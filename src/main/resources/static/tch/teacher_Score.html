<script type="text/javascript">
    function jump(url) {
        $.get(url, function (data) {
            $('#main').html(data);
        });
    }

    function onSubmit(obj) {
        var score = $(obj).val();
        var name = $(obj).parents('tr').children('.name')[0].innerHTML;
        var cname = $(obj).parents('tr').children('.cname')[0].innerHTML;
        var cid = $(obj).parents('tr').children('.cid')[0].innerHTML;
        var id = $(obj).parents('tr').children('.id')[0].innerHTML;
        var result = confirm("是否确认录入" + name + "-" + cname + "成绩：" + score + "，录入后将禁止修改！！！");
        if (result) {
            $.ajax({
                type: "post",
                url: '/tch/ascore',
                data: {score: score, cid: cid, id: id},
                success: function (data) {
                    if (data)
                        alert('录入成功');
                    else
                        alert("禁止二次录入");
                },
                error: function () {
                    alert('录入失败');
                }
            });
        } else {
            alert(name + "-" + cname + "成绩已录入，禁止二次录入！");
        }
    }

    function teacher_Score() {
        var $tbody = $('#tbody');
        var tname = null;
        var cname = null;
        var chours = null;
        var ccredit = null;
        var cscore = null;
        var name = null;
        var number = null;
        var cid = null;

        $.ajax({
            type: "GET",
            url: "/tch/score",
            dataType: "json",
            timeout: 5000,
            success: function (jsonobject) {
                for (var i = 0; i < jsonobject.length; i++) {
                    name = jsonobject[i].name;
                    number = jsonobject[i].number;
                    tname = jsonobject[i].tname;
                    cname = jsonobject[i].cname;
                    chours = jsonobject[i].chours;
                    ccredit = jsonobject[i].ccredit;
                    cscore = jsonobject[i].cscore;
                    cid = jsonobject[i].cid;
                    var content = '<tr><td class="cid">' + cid + '</td><td class="cname">' + cname + '</td><td >' + tname + '</td><td class="id">' + number + '</td>' +
                        '<td class="name">' + name + '</td><td>' + chours + '</td><td>' + ccredit + '</td><td>' + '<input style="width: 20%;" onblur="onSubmit(this)" value="' + cscore + '"></td></tr>';
                    $tbody.append(content);
                }
            },
            error: function () {
                console.log("暂无记录");
            }
        })
    }
</script>
<div class="row">
    <div class="jumbotron Background1">
        <h2>考试成绩 <span class="label label-default"></span></h2>
        <p>查看个人考试成绩</p>
        <p>
            <a class="btn btn-primary btn-lg" href="index.html" role="button">返回主页</a>
            <a class="btn btn-primary btn-lg" onclick="jump('/tch/score_detail.html')" role="button">成绩统计</a>
        </p>
    </div>
</div>


<!--该页的功能-->
<div class="card-body">
    <table class="table">
        <thead>
        <tr>
            <th scope="col">课程ID</th>
            <th scope="col">课程名称</th>
            <th scope="col">授课教师</th>
            <th scope="col">学号</th>
            <th scope="col">学生姓名</th>
            <th scope="col">学时</th>
            <th scope="col">学分</th>
            <th scope="col">课程成绩</th>
        </tr>
        </thead>
        <tbody id="tbody">
        </tbody>
    </table>
</div>
<script>teacher_Score();</script>